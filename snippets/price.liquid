{% comment %}
  Patched version:
  - 只在设置了 compare_at_price 且 compare_at_price > price 时显示划线原价
  - 否则只显示现价，不输出 .price__sale 区块
{% endcomment %}

{%- liquid
  if use_variant
    assign target = product.selected_or_first_available_variant
  elsif placeholder
    assign target = null
  else
    assign target = product
  endif

  assign compare_at_price = target.compare_at_price
  assign price = target.price | default: 1999
  assign price_min = product.price_min
  assign price_max = product.price_max
  assign available = target.available | default: false
  assign money_price = price | money
  assign money_price_min = price_min | money
  assign money_price_max = price_max | money
  if settings.currency_code_enabled
    assign money_price = price | money_with_currency
    assign money_price_min = price_min | money_with_currency
    assign money_price_max = price_max | money_with_currency
  endif

  if target == product and product.price_varies
    assign money_price = 'products.product.price.from_price_html' | t: price: money_price
  endif
-%}

{%- unless target == null and placeholder == null -%}
  {%- if show_compare_at_price and compare_at_price > price -%}
    <!-- 折扣价结构（只在设置原价且高于售价时显示） -->
    <div
      class="price price--on-sale {% if price_class %}{{ price_class }}{% endif %} {% if available == false %}price--sold-out{% endif %}"
    >
      <div class="price__sale">
        <span class="price-item price-item--sale price-item--last">
          {{ money_price }}
        </span>
        <span class="visually-hidden visually-hidden--inline">{{ 'products.product.price.regular_price' | t }}</span>
        <span>
          <s class="price-item price-item--regular">
            {% if settings.currency_code_enabled %}
              {{ compare_at_price | money_with_currency }}
            {% else %}
              {{ compare_at_price | money }}
            {% endif %}
          </s>
        </span>
        <span class="visually-hidden visually-hidden--inline">{{ 'products.product.price.sale_price' | t }}</span>
      </div>
    </div>
  {%- else -%}
    <!-- 常规价格结构（未设置原价或原价 ≤ 现价时显示） -->
    <div
      class="price {% if price_class %}{{ price_class }}{% endif %} {% if available == false %}price--sold-out{% endif %}"
    >
      <div class="price__regular">
        <span class="visually-hidden visually-hidden--inline">{{ 'products.product.price.regular_price' | t }}</span>
        <span class="price-item price-item--regular">
          {{ money_price }}
        </span>
      </div>
    </div>
  {%- endif -%}
{%- endunless -%}
